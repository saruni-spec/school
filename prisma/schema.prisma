generator client {
  provider = "prisma-client-js"
}


datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


enum attendance_status {
  present
  absent
  late
  excused
}


enum employment_status {
  full_time
  part_time
  contract
  intern
  temporary
}


enum event_role {
  participant
  organizer
  judge
  supervisor
}


enum event_scope {
  inter_school
  intra_school
  class_level
  stream_level
}


enum exam_type {
  quiz
  mid_term
  final
  assignment
}


enum facility_type {
  Educational
  Recreational
  Dining
  Sports
  Transportation
}


enum fee_type_enum {
  tuition
  library
  sports
  transport
  miscellaneous
}


enum participant_type {
  student
  teacher
  staff
  guest
}


enum participation_status {
  registered
  attended
  absent
  withdrawn
  disqualified
}


enum payment_method {
  cash
  bank_transfer
  credit_card
  mobile_money
  cheque
}


enum payment_status {
  pending
  completed
  failed
  refunded
}


enum relationship_type {
  father
  mother
  guardian
  other
}


enum reviewable_entity {
  school
  school_facility
  event
  teacher
}

enum grade_level_type {
  PRE_PRIMARY_1
  PRE_PRIMARY_2
  GRADE_1
  GRADE_2
  GRADE_3
  GRADE_4
  GRADE_5
  GRADE_6
  GRADE_7
  GRADE_8
  GRADE_9
  GRADE_10
  GRADE_11
  GRADE_12
}

enum school_type {
  PRE_PRIMARY
  LOWER_PRIMARY
  UPPER_PRIMARY
  LOWER_SECONDARY
  UPPER_SECONDARY
}



enum severity {
  emergency
  urgent
  priotity
  inquiry
  low
}

// Enum for defining broad privilege categories
enum privilege_category {
  SYSTEM_ADMIN     // Absolute system control
  EXECUTIVE        // High-level management
  ADMINISTRATIVE   // Operational management
  OPERATIONAL      // Day-to-day operations
  SUPERVISORY      // Oversight and review
  PERSONAL         // Self-related access
}
// Enum for privilege scopes
enum privilege_scope {
  GLOBAL           // Entire system
  INSTITUTIONAL    // Entire institution
  DEPARTMENTAL     // Department level
  PERSONAL         // Individual level
}

enum system_resource {
 SYSTEM
  INSTITUTION
  USERS
  STUDENTS
  STAFF
  DEPARTMENTS
  EVENTS
  EXAMINATIONS
  FACILITIES
  FINANCES
  MEDICAL
  LIBRARY
  ACADEMIC_CLASSES
  ACADEMIC_STREAMS
  ADMISSIONS
  CURRICULUM
  COMMUNICATION
}

// Comprehensive Role Types Enum
enum role_type {
  // System-Level Roles
  SYSTEM_ADMINISTRATOR  // Absolute system control, highest level of access

  // Executive Leadership Roles
  PRINCIPAL             // Top institutional leadership
  VICE_PRINCIPAL        // Deputy institutional leadership
  SCHOOL_ADMINISTRATOR  // Comprehensive school-level administrative role

  // Academic Leadership Roles
  HEAD_OF_DEPARTMENT    // Department-level academic leadership
  ACADEMIC_REGISTRAR    // Academic records and registration management
  EXAM_CONTROLLER       // Examinations management
  CURRICULUM_COORDINATOR // Curriculum development and oversight

  // Teaching Roles
  TEACHER               // Standard teaching position
  CLASS_TEACHER         // Additional responsibilities for a specific class
  FACULTY_MEMBER        // Broader academic staff role

  // Administrative Roles
  ADMINISTRATIVE_STAFF  // General administrative support
  SECRETARY             // Administrative coordination
  FACILITY_MANAGER      // Facilities management
  FINANCIAL_OFFICER     // Financial management
  HUMAN_RESOURCES_MANAGER  // Personnel and HR management
  EVENT_COORDINATOR     // Event planning and management

  // Support and Specialized Roles
  LIBRARIAN             // Library management
  ASSISTANT_LIBRARIAN   // Support for library operations
  TECHNOLOGY_SUPPORT    // IT and technical support
  SECURITY_PERSONNEL    // Campus security
  
  // Student and Admission Related Roles
  ADMISSIONS_OFFICER    // Student admissions management
  COUNSELOR             // Student guidance and support
  
  // Medical and Health Roles
  MEDICAL_STAFF         // Healthcare professionals
  
  // Non-Academic Roles
  CHEF                  // Food services management

  // Student and Parent Roles
  STUDENT               // Current students
  PARENT                // Student guardians

  // Audit and Compliance
  AUDIT_OFFICER         // Compliance and internal audit
}


model school {
  id                          Int                        @id @default(autoincrement())
  name                        String                     @db.VarChar(100)  @unique
  type                        school_type
  address                     String?
  contact_info                Json?
  license_info                Json?
  created_at                  DateTime?                  @default(now()) @db.Timestamptz(6)
  updated_at                  DateTime?                  @default(now()) @db.Timestamptz(6)
  deleted_at                  DateTime?                  @db.Timestamptz(6)

  academic_year               academic_year[]
  award                       award[]
  department                  department[]
  event_school_participant    event_school_participant[]
  fee_type                    fee_type[]
  review                      review[]
  school_facility             school_facility[]          @ignore
  staff                       staff[]
  permission                  permission[]
  users                       users[]
  course_material             course_material[]
}


model facility {
  id                      Int                     @id   @default(autoincrement())
  name                    String?                 @db.VarChar(50)
  type                    facility_type?
  deleted_at              DateTime?               @db.Timestamptz(6)

  school_facility         school_facility[]       @ignore

  @@unique([name,type])
}


model school_facility {
  id                      Int             @id @default(autoincrement())
  school_id               Int
  facility_id             Int
  description             String?         @db.VarChar(100)
  deleted_at              DateTime?       @db.Timestamptz(6)
  capacity                Int?
  opening_hours           DateTime?
  closing_hours           DateTime?
  overseer                Int

  facility                facility?    @relation(fields: [facility_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  school                  school?      @relation(fields: [school_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  staff                   staff?       @relation(fields: [overseer], references: [id], onDelete: NoAction, onUpdate: NoAction)

  lib_books               lib_book[]
  permission              permission[]

  @@unique([school_id,facility_id])
}

model lib_book {
  id                    Int              @id @default(autoincrement())
  school_facility_id    Int
  book_name             String
  reference_number      String
  parental_advisory     Boolean?
  subject_id            Int?
  borrowed_by           Int?
  borrowed_on           DateTime?
  due_by                DateTime?
  returned_on           DateTime?
  damaged_by            Int?
  created_at            DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?       @default(now()) @db.Timestamptz(6)
  deleted_at            DateTime?       @db.Timestamptz(6)

  school_facility       school_facility @relation(fields: [school_facility_id], references: [id])
  

  subject               subject?        @relation(fields: [subject_id], references: [id])
}


model academic_year {
  id                        Int               @id @default(autoincrement())
  school_id                 Int?
  year                      String            @db.VarChar(50)
  start_date                DateTime          @db.Date
  end_date                  DateTime          @db.Date
  is_current                Boolean?          @default(false)
  created_at                DateTime?         @default(now()) @db.Timestamptz(6)

  school                    school?           @relation(fields: [school_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  semester                  semester[]
  class_level               class_level[]
  
  @@unique([school_id, year])  
}


model semester {
  id                     Int                    @id @default(autoincrement())
  academic_year_id       Int?
  name                   String                 @db.VarChar(50)
  start_date             DateTime               @db.Date
  end_date               DateTime               @db.Date
  is_current             Boolean?               @default(false)
  created_at             DateTime?              @default(now()) @db.Timestamptz(6)

  academic_year          academic_year?         @relation(fields: [academic_year_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  student_ellectives     student_ellectives[]
  announcement           announcement[]
  award                  award[]
  fee                    fee[]
  event                  event[]
  exam                   exam[]
  subject_allocation     subject_allocation[]
  stream_assigment       stream_assigment[]


  

@@unique([academic_year_id,name])
}


model class_level {
  id                          Int                       @id @default(autoincrement())
  academic_year_id            Int?
  name                        String                    @db.VarChar(50)
  grade_level                 grade_level_type
  is_active                   Boolean?                  @default(true)
  created_at                  DateTime?                 @default(now()) @db.Timestamptz(6)
  
  academic_year               academic_year?            @relation(fields: [academic_year_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  event_class_participant     event_class_participant[]
  stream                      stream[]
  fee                         fee[]
  permission                  permission[]
  student                     student[]

  @@map("class")
  @@unique([academic_year_id,grade_level])
}


model stream {
  id                           Int                          @id @default(autoincrement())
  class_id                     Int?
  name                         String                       @db.VarChar(50)
  capacity                     Int?
  created_at                   DateTime?                    @default(now()) @db.Timestamptz(6)
  deleted_at                   DateTime?                    @db.Timestamptz(6)

  class_level                  class_level?                 @relation(fields: [class_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  event_stream_participant     event_stream_participant[]
  exam_sitting                 exam_sitting[]
  
  subject_allocation           subject_allocation[]
  assignment                   assignment[]
  slot_assignment              slot_assignment[]
  permission                   permission[]

  @@unique([class_id,name])
}


model course_material {
  id                      Int                        @id @default(autoincrement())
  name                    String                     @db.VarChar(50)
  published_by            Int?
  school_id               Int?
  subject_id              Int?
  grade_level             grade_level_type               
  description             String                     @db.VarChar(100)

  subject                 subject?                   @relation(fields: [subject_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  school                  school?                    @relation(fields: [school_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users                   users?                     @relation(fields: [published_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model gallery {
  id                                         Int         @id @default(autoincrement())
  created_for                                String                     @db.VarChar(50)
  created_at                                 DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at                                 DateTime?   @default(now()) @db.Timestamptz(6)
  deleted_at                                 DateTime?   @db.Timestamptz(6)
  picture                                    picture[]
}


model picture {
  id                                         Int       @id @default(autoincrement())
  picture_location                           String                     @db.VarChar(50)
  taken_by                                   Int
  about                                      String                     @db.VarChar(150)
  taken_for                                  Int
  gallery_id                                 Int?
  created_at                                 DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at                                 DateTime?   @default(now()) @db.Timestamptz(6)
  deleted_at                                 DateTime?   @db.Timestamptz(6)
  gallery                                    gallery?     @relation(fields:[gallery_id],references :[id], onDelete: NoAction, onUpdate: NoAction)
  users                                      users       @relation(fields:[taken_by],references :[id], onDelete: NoAction, onUpdate: NoAction)
}


model department {
  id                                         Int       @id @default(autoincrement())
  school_id                                  Int?
  name                                       String    @db.VarChar(100)
  description                                String?
  created_at                                 DateTime? @default(now()) @db.Timestamptz(6)
  updated_at                                 DateTime? @default(now()) @db.Timestamptz(6)
  deleted_at                                 DateTime? @db.Timestamptz(6)

  school                                     school?   @relation(fields: [school_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  staff                                      staff[]  
  subject_allocation                         subject_allocation[]
  permission                                 permission[]
  department_head                            department_head[]

  @@unique([school_id,name])
}

model department_head {
  staff_id                                   Int
  department_id                              Int

  created_at                                 DateTime? @default(now()) @db.Timestamptz(6)
  updated_at                                 DateTime? @default(now()) @db.Timestamptz(6)
  deleted_at                                 DateTime? @db.Timestamptz(6)

  department                                 department?        @relation(fields: [department_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  staff                                      staff?             @relation(fields: [staff_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([staff_id,department_id])
}


model users {
  id                                 Int                      @id @default(autoincrement())
  name                               String?                  @db.VarChar(50)
  first_name                         String                   @db.VarChar(50)
  last_name                          String                   @db.VarChar(50)
  email                              String                   @unique @db.VarChar(100)
  phone                              String?                  @db.VarChar(20)
  date_of_birth                      DateTime?                @db.Date
  address                            String?
  password                           String
  emergency_contacts                 Json?
  role_id                            Int?
  deleted_at                         DateTime?                @db.Timestamptz(6)
  current_school                     Int? 

  role                               role?                    @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  school                             school?                  @relation(fields: [current_school], references: [id], onDelete: NoAction, onUpdate: NoAction)

  announcement                       announcement[]
  event                              event[]
  event_user_participant             event_user_participant[]
  messages_messages_recepientTousers messages[]               @relation("messages_recepientTousers")
  messages_messages_senderTousers    messages[]               @relation("messages_senderTousers")
  parent                             parent[]
  review                             review[]
  staff                              staff[]
  student                            student[]
  admin                              admin[]
  picture                            picture[]
  medical                            medical[]
  course_material                    course_material[]
}

model medical {
  id                                              Int                      @id @default(autoincrement())
  user_id                                         Int
  description                                     String                   @unique @db.VarChar(100)                              
  notes                                           String                   @unique @db.VarChar(100)
  medic_id                                        Int?
  created_at                                      DateTime?                @default(now()) @db.Timestamptz(6)
  updated_at                                      DateTime?                @default(now()) @db.Timestamptz(6)
  deleted_at                                      DateTime?                @db.Timestamptz(6)

  users                                           users?                   @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

}

model role {
  id                        Int                  @id @default(autoincrement())
  type                      role_type            @unique
  name                      String
  description               String?
  category                  privilege_category?
  
  // Timestamp tracking
  created_at                DateTime             @default(now())
  updated_at                DateTime             @default(now())
  deleted_at                DateTime?
  

  permissions               permission[]
  users                     users[]
 
  @@unique([type, category])
}


model permission {
  id                   Int                 @id @default(autoincrement())

  role_id              Int
  role                 role                @relation(fields: [role_id], references: [id], onDelete: Cascade)

  resource             system_resource
  scope                privilege_scope      @default(DEPARTMENTAL)
 
  can_admin            Boolean             @default(false)
  can_create           Boolean             @default(false)
  can_read             Boolean             @default(false)
  can_update           Boolean             @default(false)
  can_delete           Boolean             @default(false)

  department_id        Int?
  school_id            Int?
  class_id             Int?
  school_facility_id   Int?
  stream_id            Int?

  department           department?         @relation(fields: [department_id], references: [id], onDelete: SetNull)
  school               school?             @relation(fields: [school_id], references: [id], onDelete: SetNull)
  class_level          class_level?        @relation(fields: [class_id], references: [id], onDelete: SetNull)          
  school_facility      school_facility?    @relation(fields: [school_facility_id], references: [id], onDelete: SetNull)
  stream               stream?             @relation(fields: [stream_id], references: [id], onDelete: SetNull)

  created_at           DateTime            @default(now())
  updated_at           DateTime            @default(now())
  deleted_at           DateTime?
  
  @@unique([role_id, resource,scope,can_admin,can_create,can_delete,can_read,can_update])
  @@index([resource, department_id, school_id, class_id])
}

model admin{
  id                                 Int                @id @default(autoincrement())
  user_id                            Int                @unique
  created_at                         DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at                         DateTime?          @default(now()) @db.Timestamptz(6)
  deleted_at                         DateTime?          @db.Timestamptz(6)

  users                              users?             @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
 

}


model staff {
  id                                              Int                @id @default(autoincrement())
  school_id                                       Int?
  department_id                                   Int?
  user_id                                         Int                @unique
  employment_status                               employment_status?
  qualifications                                  Json?
  join_date                                       DateTime?          @default(now())  @db.Date
  created_at                                      DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at                                      DateTime?          @default(now()) @db.Timestamptz(6)
  deleted_at                                      DateTime?          @db.Timestamptz(6)
  
  department                                      department?        @relation(fields: [department_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  school                                          school?            @relation(fields: [school_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users                                           users?             @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  school_facility                                 school_facility[]                                   
  teacher                                         teacher[]
  department_head                                 department_head[]
  
  @@index([school_id], map: "idx_staff_school_id")
}


model teacher {
  id                    Int               @id @default(autoincrement())
  staff_id              Int?              @unique
  specialization        String?           @db.VarChar(100)
  is_active             Boolean?          @default(true)
  created_at            DateTime?         @default(now()) @db.Timestamptz(6)
  deleted_at            DateTime?         @db.Timestamptz(6)

  staff                 staff?            @relation(fields: [staff_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  exam_sitting          exam_sitting[]
  result                result[]
  review                review[]
  subject_allocation    subject_allocation[]
  slot_assignment       slot_assignment[]
  stream_assigment      stream_assigment[]
  assignment            assignment[]
}


model subject {
  id                    Int               @id @default(autoincrement())
  name                  String            @db.VarChar(100) @unique
  description           String?
  created_at            DateTime?         @default(now()) @db.Timestamptz(6)
  deleted_at            DateTime?         @db.Timestamptz(6)

  
  subject_allocation    subject_allocation[]
  course_material       course_material[]
  lib_book              lib_book[]

}


model subject_allocation {
  id                        Int                       @id @default(autoincrement())
  code                      String?                   @unique @db.VarChar(20)
  department_id             Int?
  teacher_id                Int?
  subject_id                Int
  stream_id                 Int
  semester_id               Int
  assigned_date             DateTime?                 @default(dbgenerated("CURRENT_DATE")) @db.Date
  deleted_at                DateTime?                 @db.Timestamptz(6)

  stream                    stream                    @relation(fields: [stream_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  semester                  semester                  @relation(fields: [semester_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subject                   subject                   @relation(fields: [subject_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  teacher                   teacher?                  @relation(fields: [teacher_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  department                department?               @relation(fields: [department_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  
  student_ellectives    student_ellectives[]
  exam_sitting          exam_sitting[]
  slot_assignment       slot_assignment[]
  assignment            assignment[]
  
  @@unique([teacher_id, subject_id])
}

model student {
  id                    Int               @id @default(autoincrement())
  user_id               Int               @unique
  created_at            DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?         @default(now()) @db.Timestamptz(6)
  deleted_at            DateTime?         @db.Timestamptz(6)
          
  current_class         Int?

  users                 users?            @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  class_level           class_level?      @relation(fields: [current_class], references: [id], onDelete: NoAction, onUpdate: NoAction)

  parent_student        parent_student[]
  payment               payment[]
  result                result[]
  student_stream        student_stream[]
  student_ellectives    student_ellectives[]
}


model student_stream {
  student_id                 Int
  stream_assigment_id        Int
  admission_number           String?            @unique @db.VarChar(20)
  admission_date             DateTime           @db.Date
  start_date                 DateTime           @db.Date
  end_date                   DateTime?          @db.Date
  deleted_at                 DateTime?          @db.Timestamptz(6)
  stream_assigment           stream_assigment   @relation(fields: [stream_assigment_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  student                    student            @relation(fields: [student_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([student_id, stream_assigment_id])
}


model assignment {
  id                      Int                    @id @default(autoincrement())
  description             String                 @db.VarChar(100)
  teacher_id              Int
  subject_allocation_id   Int?
  stream_id               Int?
  due_date                DateTime?              @db.Date

  teacher                 teacher?               @relation(fields: [teacher_id], references: [id])
  subject_allocation      subject_allocation?    @relation(fields: [subject_allocation_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  stream                  stream?                @relation(fields: [stream_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}


model stream_assigment{
  id                          Int                       @id @default(autoincrement())
  stream_id                   Int
  teacher_id                  Int
  semester_id                 Int
  is_active                   Boolean?                  @default(true)
  created_at                  DateTime?                 @default(now()) @db.Timestamptz(6)
  student_stream              student_stream[]
  semester                    semester?                 @relation(fields: [semester_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  teacher                     teacher?                  @relation(fields: [teacher_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}


model student_ellectives {
  student_id                  Int
  subject_allocation_id       Int
  semester_id                 Int
  enrollment_date             DateTime?                 @default(dbgenerated("CURRENT_DATE")) @db.Date
  deleted_at                  DateTime?                 @db.Timestamptz(6)

  semester                    semester                  @relation(fields: [semester_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subject_allocation          subject_allocation        @relation(fields: [subject_allocation_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  student                     student                   @relation(fields: [student_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  @@id([student_id, subject_allocation_id])
}


model parent {
  id                Int               @id @default(autoincrement())
  user_id           Int?              @unique
  relationship_type relationship_type
  created_at        DateTime?         @default(now()) @db.Timestamptz(6)
  deleted_at        DateTime?         @db.Timestamptz(6)
  users             users?            @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  parent_student    parent_student[]

}


model parent_student {
  parent_id         Int
  student_id        Int
  deleted_at        DateTime? @db.Timestamptz(6)
  parent            parent    @relation(fields: [parent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  student           student   @relation(fields: [student_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([parent_id, student_id])
}


model slot {
  id                Int           @id @default(autoincrement())
  name              String?           @db.VarChar(50)
  day_of_week       Int
  start_time        DateTime      @db.Time(6)
  end_time          DateTime      @db.Time(6)
  room_number       String?       @db.VarChar(20)
  created_at        DateTime?     @default(now()) @db.Timestamptz(6)
  deleted_at        DateTime?     @db.Timestamptz(6)
  slot_assignments  slot_assignment[]

  @@unique([day_of_week,start_time,end_time])
}


model slot_assignment {
  id                             Int                          @id @default(autoincrement())
  slot_id                        Int
  stream_id                      Int
  teacher_id                     Int
  subject_allocation_id          Int
  created_at                     DateTime?                    @default(now()) @db.Timestamptz(6)
  deleted_at                     DateTime?                    @db.Timestamptz(6)

  slot                           slot                         @relation(fields: [slot_id], references: [id])
  teacher                        teacher                      @relation(fields: [teacher_id], references: [id])
  subject_allocation             subject_allocation           @relation(fields: [subject_allocation_id], references: [id])
  stream                         stream?                      @relation(fields: [stream_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  @@unique([slot_id, teacher_id,stream_id])
}


model exam {
  id                  Int            @id @default(autoincrement())
  semester_id         Int?
  name                String         @db.VarChar(100)
  start_date          DateTime?      @db.Date
  end_date            DateTime?      @db.Date
  type                exam_type
  created_at          DateTime?      @default(now()) @db.Timestamptz(6)
  deleted_at          DateTime?      @db.Timestamptz(6)
  semester            semester?      @relation(fields: [semester_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  exam_sitting        exam_sitting[]

  @@unique([semester_id, name, type, start_date])
}


model exam_sitting {
  id                    Int             @id @default(autoincrement())
  exam_id               Int?
  supervisor            Int?
  subject_allocation_id Int?
  stream_id             Int?
  out_of                Decimal?                   @db.Decimal(5, 2)
  remarks               String?
  sitting_date          DateTime                   @db.Date
  created_at            DateTime?                  @default(now()) @db.Timestamptz(6)
  total_marks           Int
  deleted_at            DateTime?                  @db.Timestamptz(6)
  exam                  exam?                      @relation(fields: [exam_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  stream                stream?                    @relation(fields: [stream_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subject_allocation    subject_allocation?        @relation(fields: [subject_allocation_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  teacher               teacher?                   @relation(fields: [supervisor], references: [id], onDelete: NoAction, onUpdate: NoAction)
  result                result[]

  @@unique([stream_id, subject_allocation_id, exam_id, sitting_date])
}


model fee {
  id               Int               @id @default(autoincrement())
  fee_type_id      Int?
  name             String?           @db.VarChar(50)
  amount           Decimal           @db.Decimal(10, 2)
  due_date         DateTime?         @db.Date
  semester_id      Int
  class_id         Int?
  created_at       DateTime?         @default(now()) @db.Timestamptz(6)
  deleted_at       DateTime?         @db.Timestamptz(6)
  semester         semester?         @relation(fields: [semester_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  class_level      class_level?      @relation(fields: [class_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  fee_type         fee_type?         @relation(fields: [fee_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  payment          payment[]

  @@unique([fee_type_id,amount,semester_id])
}


model fee_type {
  id                Int             @id @default(autoincrement())
  school_id         Int?
  name              fee_type_enum
  description       String?
  created_at        DateTime?       @default(now()) @db.Timestamptz(6)
  deleted_at        DateTime?       @db.Timestamptz(6)
  fee               fee[]
  school            school?         @relation(fields: [school_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

@@unique([school_id,name])
}


model announcement {
  id              Int         @id @default(autoincrement())
  announcement    String?     @db.VarChar(500)
  semester_id     Int?
  created_at      DateTime?   @default(now()) @db.Timestamptz(6)
  date_for        DateTime    @db.Date
  valid_upto      DateTime    @db.Date
  scope           event_scope
  made_by         Int?
  deleted_at      DateTime?   @db.Timestamptz(6)
  users           users?      @relation(fields: [made_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  semester        semester?   @relation(fields: [semester_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

 @@unique([semester_id, date_for, made_by, scope])
}


model award {
  id          Int       @id @default(autoincrement())
  name        String?   @db.VarChar(100)
  semester_id Int?
  awarded_by  String?   @db.VarChar(100)
  awared_for  String?   @db.VarChar(100)
  school_id   Int?
  school      school?   @relation(fields: [school_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  semester    semester? @relation(fields: [semester_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

@@unique([semester_id,name])
}


model event {
  id                       Int                        @id @default(autoincrement())
  name                     String                     @db.VarChar(100)
  description              String?
  location                 String?                    @db.VarChar(200)
  start_date               DateTime                   @db.Timestamptz(6)
  end_date                 DateTime                   @db.Timestamptz(6)
  scope                    event_scope
  semester_id              Int?
  created_at               DateTime?                  @default(now()) @db.Timestamptz(6)
  created_by               Int?
  deleted_at               DateTime?                  @db.Timestamptz(6)
  users                    users?                     @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  semester                 semester?                  @relation(fields: [semester_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  event_class_participant  event_class_participant[]
  event_school_participant event_school_participant[]
  event_stream_participant event_stream_participant[]
  event_user_participant   event_user_participant[]
  review                   review[]

  @@index([start_date, end_date], map: "idx_event_date")
  @@index([scope], map: "idx_event_scope")
  @@unique([semester_id,name])
}


model event_class_participant {
  event_id          Int
  class_id          Int
  registration_date DateTime?             @default(now()) @db.Timestamptz(6)
  status            participation_status? @default(registered)
  deleted_at        DateTime?             @db.Timestamptz(6)
  class_level      class_level          @relation(fields: [class_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  event             event                 @relation(fields: [event_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([event_id, class_id])
}


model event_school_participant {
  event_id          Int
  school_id         Int
  registration_date DateTime?             @default(now()) @db.Timestamptz(6)
  status            participation_status? @default(registered)
  deleted_at        DateTime?             @db.Timestamptz(6)
  event             event                 @relation(fields: [event_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  school            school                @relation(fields: [school_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([event_id, school_id])
  @@index([event_id, school_id], map: "idx_event_school_participant")
}


model event_stream_participant {
  event_id          Int
  stream_id         Int
  registration_date DateTime?             @default(now()) @db.Timestamptz(6)
  status            participation_status? @default(registered)
  deleted_at        DateTime?             @db.Timestamptz(6)
  event             event                 @relation(fields: [event_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  stream            stream                @relation(fields: [stream_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([event_id, stream_id])
}


model event_user_participant {
  event_id          Int
  user_id           Int
  participant_type  participant_type
  registration_date DateTime?             @default(now()) @db.Timestamptz(6)
  attendance_status participation_status? @default(registered)
  role              event_role?
  deleted_at        DateTime?             @db.Timestamptz(6)
  event             event                 @relation(fields: [event_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users             users                 @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([event_id, user_id])
  @@index([event_id, user_id], map: "idx_event_user_participant")
}


model messages {
  id                              Int       @id @default(autoincrement())
  message_details                 String?   @db.VarChar(200)
  topic                           String?   @db.VarChar(30)
  severity                        severity?
  sender                          Int?
  recepient                       Int?
  deleted_at                      DateTime? @db.Timestamptz(6)
  users_messages_recepientTousers users?    @relation("messages_recepientTousers", fields: [recepient], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_messages_senderTousers    users?    @relation("messages_senderTousers", fields: [sender], references: [id], onDelete: NoAction, onUpdate: NoAction)


}


model payment {
  id               Int             @id @default(autoincrement())
  student_id       Int?
  fee_id           Int?
  amount           Decimal         @db.Decimal(10, 2)
  payment_date     DateTime?       @default(now()) @db.Timestamptz(6)
  payment_method   payment_method
  status           payment_status? @default(pending)
  reference_number String          @unique @db.VarChar(100)
  created_at       DateTime?       @default(now()) @db.Timestamptz(6)
  deleted_at       DateTime?       @db.Timestamptz(6)
  fee              fee?            @relation(fields: [fee_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  student          student?        @relation(fields: [student_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([student_id], map: "idx_payment_student_id")
}


model result {
  student_id      Int
  marked_by       Int?
  marks_obtained  Decimal?     @db.Decimal(5, 2)
  exam_sitting_id Int
  deleted_at      DateTime?    @db.Timestamptz(6)
  exam_sitting    exam_sitting @relation(fields: [exam_sitting_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  teacher         teacher?     @relation(fields: [marked_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  student         student      @relation(fields: [student_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([student_id, exam_sitting_id])
}


model review {
  id                 Int               @id @default(autoincrement())
  reviewer_id        Int
  entity_type        reviewable_entity
  school_id          Int?
  school_facility_id Int?
  event_id           Int?
  teacher_id         Int?
  rating             Int
  title              String?           @db.VarChar(100)
  content            String
  created_at         DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?         @default(now()) @db.Timestamptz(6)
  deleted_at         DateTime?         @db.Timestamptz(6)
  event              event?            @relation(fields: [event_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users              users             @relation(fields: [reviewer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  school             school?           @relation(fields: [school_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  teacher            teacher?          @relation(fields: [teacher_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([entity_type], map: "idx_review_entity_type")
  @@unique([reviewer_id,entity_type,title])
}

